<!--
  ~  Copyright 2015 Ripple OSI
  ~
  ~      Licensed under the Apache License, Version 2.0 (the "License");
  ~      you may not use this file except in compliance with the License.
  ~      You may obtain a copy of the License at
  ~
  ~          http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~      Unless required by applicable law or agreed to in writing, software
  ~      distributed under the License is distributed on an "AS IS" BASIS,
  ~      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~      See the License for the specific language governing permissions and
  ~      limitations under the License.
  ~
  -->

<div class="modal-header" xmlns="http://www.w3.org/1999/html">
    <h4 class="modal-title">Transfer of Care</h4>
</div>

<div class="modal-body">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">{{ patient.name }}</h4>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-sm-4 text-left"><label>DOB:</label> <strong>{{ patient.dateOfBirth | date:'dd-MMM-yyyy' }}</strong></div>
        <div class="col-sm-4 text-center"><label>Gender:</label> <strong>{{ patient.gender }}</strong></div>
        <div class="col-sm-4 text-right"><label>NHS No:</label> <strong>{{ patient.nhsNumber | formatNHSNumber }}</strong></div>
      </div>
    </div>
  </div>

  <div class="row" ng-show="!displayDetail">

    <div class="col-md-3">
      <ul class="list-group">
        <li class="list-group-item" style="font-weight: bold">Problems <span class="badge badge-default">{{ transferOfCare.problems.length }}</span> </li>
        <li class="list-group-item" ng-repeat="problem in problems" ng-click="selectTransferOfCareItem($index, 'problems')" ng-class="isItemSelected($index,'problems')">
          <div class="row">
            <div class="col-xs-9">
              {{problem.problem}}
            </div>
            <div class="col-xs-3">
              <span ng-class="isItemSelectedIcon($index,'problems')"></span>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <div class="col-md-3">
      <ul class="list-group">
        <li class="list-group-item" style="font-weight: bold">Medications <span class="badge badge-default">{{ transferOfCare.medication.length }}</span></li>
        <li class="list-group-item" ng-repeat="medication in medications" ng-click="selectTransferOfCareItem($index, 'medications')" ng-class="isItemSelected($index,'medications')">
          <div class="row">
            <div class="col-xs-9">
              {{medication.name}}
            </div>
            <div class="col-xs-3">
              <span ng-class="isItemSelectedIcon($index,'medications')"></span>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <div class="col-md-3">
      <ul class="list-group">
        <li class="list-group-item" style="font-weight: bold">Allergies <span class="badge badge-default">{{ transferOfCare.allergies.length }}</span> </li>
        <li class="list-group-item" ng-repeat="allergy in allergies" ng-click="selectTransferOfCareItem($index, 'allergies')" ng-class="isItemSelected($index,'allergies')">
          <div class="row">
            <div class="col-xs-9">
              {{allergy.cause}}
            </div>
            <div class="col-xs-3">
              <span ng-class="isItemSelectedIcon($index,'allergies')"></span>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <div class="col-md-3">
      <ul class="list-group">
        <li class="list-group-item" style="font-weight: bold">Contacts <span class="badge badge-default">{{ transferOfCare.contacts.contacts.length }}</span> </li>
        <li class="list-group-item" ng-repeat="contact in contacts" ng-click="selectTransferOfCareItem($index, 'contacts')" ng-class="isItemSelected($index,'contacts')">
          <div class="row">
            <div class="col-xs-9">
              {{contact.name}}
            </div>
            <div class="col-xs-3">
              <span ng-class="isItemSelectedIcon($index,'contacts')"></span>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <form class="form-horizontal" name="transferOfCareForm" ng-show="!displayDetail">
    <fieldset>
      <legend>Details</legend>

      <div class="form-group">
        <label class="control-label col-md-4">From (Site/Organisation)</label>
        <div class="col-md-8">
          <span>{{siteFrom}}</span>
          <span ng-if="!siteFrom">No From (Site/Organisation) selected</span>
        </div>
      </div>

      <div class="form-group" ng-class="{'has-error': (formSubmitted || transferOfCareForm.siteTo.$dirty) && transferOfCareForm.siteTo.$invalid, 'has-success': transferOfCareForm.siteTo.$valid && transferOfCareForm.siteTo.$dirty}">
        <label for="siteTo" class="control-label col-md-4">To (Site/Organisation)</label>
        <div class="col-md-8">
          <div class="input-group">
            <select class="form-control" name="siteTo" id="siteTo" ng-model="details.siteTo" required>
              <option value="">Select a Site</option>
              <option>KINGS COLLEGE HOSPITAL</option>
              <!--Removed as it is default in database-->
              <!-- <option>WORCESTERSHIRE HEALTH AND CARE NHS TRUST</option>-->
              <option>ST JAMES'S UNIVERSITY HOSPITAL</option>
              <option>OXFORD HEALTH NHS FOUNDATION TRUST</option>
              <option>HINCHINGBROOKE HEALTH CARE NHS TRUST</option>
            </select>
            <span class="input-group-addon input-sm">
                <i class="fa fa-check fa-fw"></i>
            </span>
          </div>
          <span class="help-block animate-fade" ng-show="formSubmitted && transferOfCareForm.siteTo.$error.required">You must select a value.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="reasonForContact" class="control-label col-md-4">Reason for Contact</label>
        <div class="col-md-8">
          <textarea class="form-control" rows="3" id="reasonForContact" ng-model="details.reasonForContact"></textarea>
        </div>
      </div>

      <div class="form-group">
        <label for="clinicalSummary" class="control-label col-md-4">Clinical Summary</label>
        <div class="col-md-8">
          <textarea class="form-control" rows="3" id="clinicalSummary" ng-model="details.clinicalSummary"></textarea>
        </div>
      </div>

    </fieldset>
  </form>

  <!-- Hidden -->
  <div ng-show="displayDetail" class="row transfer-of-care-detail">
    <div class="row">
      <div class="col-xs-12">
       <form class="form-horizontal">
          <fieldset class="transfer-of-care-detail-fieldset">
            <legend>Selected Items</legend>

            <div class="form-group">
              <div class="col-md-12">

                <h5>Problems</h5>
                <ul>
                  <li ng-repeat="(key,value) in selectedProblems">{{value.problem}}</li>
                </ul>
                <span class="transfer-of-care-no-selected-items" ng-if="!selectedProblems.length">No problems selected</span>

                <h5>Medications</h5>
                <ul>
                  <li ng-repeat="(key,value) in selectedMedications">{{value.name}}</li>
                </ul>
                <span class="transfer-of-care-no-selected-items" ng-if="!selectedMedications.length">No medication selected</span>

                <h5>Allergies</h5>
                <ul>
                  <li ng-repeat="(key,value) in selectedAllergies">{{value.cause}}</li>
                </ul>
                <span class="transfer-of-care-no-selected-items" ng-if="!selectedAllergies.length">No allergies selected</span>

                <h5>Contacts</h5>
                <ul>
                  <li ng-repeat="(key,value) in selectedContacts">{{value.name}}</li>
                </ul>
                <span class="transfer-of-care-no-selected-items" ng-if="!selectedContacts.length">No contacts selected</span>

              </div>
            </div>

          </fieldset>
        </form>
      </div>
    </div>

    <div class="row">
      <div class="col-xs-12">
      <form class="form-horizontal transfer-of-care-detail">
        <fieldset class="transfer-of-care-detail-fieldset">
          <legend>Details</legend>

          <div class="form-group">
            <div class="col-md-8">
              <h5>From (Site/Organisation)</h5>
              <ul ng-if="siteFrom">
                <li>{{siteFrom}}</li>
              </ul>
              <span class="transfer-of-care-no-selected-items" ng-if="!siteFrom">No From (Site/Organisation) selected</span>

              <h5>To (Site/Organisation)</h5>
              <ul ng-if="details.siteTo">
                <li>{{details.siteTo}}</li>
              </ul>
              <span class="transfer-of-care-no-selected-items" ng-if="!details.siteTo">No To (Site/Organisation) selected</span>

              <h5>Reason for Contact</h5>
              <ul ng-if="details.reasonForContact">
                <li>{{details.reasonForContact}}</li>
              </ul>
              <span class="transfer-of-care-no-selected-items" ng-if="!details.reasonForContact">No reason specified</span>

              <h5>Clinical Summary</h5>
              <ul ng-if="details.clinicalSummary">
                <li>{{details.clinicalSummary}}</li>
              </ul>
              <span class="transfer-of-care-no-selected-items" ng-if="!details.clinicalSummary">No clinical summary</span>
            </div>
          </div>

        </fieldset>
      </form>
      </div>
    </div>

    <div class="modal-footer transfer-of-care-detail">
      <a class="btn btn-info" ng-click="toggleDetailView()">Cancel</a>
      <button class="btn btn-success" ng-click="formSubmitted = true; ok(transferOfCareForm, transferOfCare);"><i class="fa fa-check"></i> Submit</button>
  </div>

  </div><!--end hidden-->
</div><!--end modal body-->

<div class="modal-footer" ng-show="!displayDetail">
  <a class="btn btn-danger" ng-click="dismiss()">Cancel</a>
  <button class="btn btn-success" ng-click="getSelectedItItemsForSummary(transferOfCareForm);"><i class="fa fa-check"></i> Complete</button>
</div>


